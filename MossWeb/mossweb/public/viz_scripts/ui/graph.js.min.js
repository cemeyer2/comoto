var groupIds;var overNode=false;var mouseX,mouseY;$(document).ready(function(){$(document).mousemove(function(a){mouseX=a.pageX;mouseY=a.pageY})});function toggleFadeSubmissionNode(h){var g="submission"+h.id;var b=[];for(var a in matches){var c=matches[a];if((c.submission_1_id===h.id||c.submission_2_id===h.id)&&$("#submission"+h.id).css("opacity")==$("#match"+matches[a].id).css("opacity")){b.push("match"+matches[a].id)}}var e=function(j){var i=0.2;var l=1;var k="fast";var m=Math.round(parseFloat(j.css("opacity")));if(m==0){j.fadeTo(k,l)}else{j.fadeTo(k,i)}};e($("#"+g));for(var d in b){var f=b[d];e($("#"+f))}}function buildMatchLinks(c,b){var a=c.selectAll("line.link").data(b.links).enter();a=a.append("line").attr("stroke","#999").style("stroke-opacity",".6").style("stroke-width",function(d){var e=d.value/100;return 3+(e*e)*5}).attr("x1",function(d){return d.source.x}).attr("y1",function(d){return d.source.y}).attr("x2",function(d){return d.target.x}).attr("y2",function(d){return d.target.y}).attr("id",function(d){return"match"+d.id}).style("stroke",colorMatchEdge);a.each(function(d){d.lockedPopover=false;$("#match"+d.id).popover({delay:graphControls.useFisheye?0:500,animation:!graphControls.useFisheye,placement:function(e){e.id="matchPopover"+d.id;return"right"},trigger:"manual",title:generateMatchPopoverTitle(d),content:generateMatchPopoverContent(d)})}).on("mouseover",function(d){if(!d.lockedPopover){$("#match"+d.id).popover("show");var e=$("#matchPopover"+d.id);e.offset({left:mouseX+5,top:mouseY-e.height()/2})}}).on("mouseout",function(d){if(!d.lockedPopover){$("#match"+d.id).popover("hide")}}).on("click",function(d){d.lockedPopover=!d.lockedPopover});return a}function buildSubmissionNodes(d,c,b){var a=d.selectAll("circle.node").data(c.nodes).enter();a=a.append("circle").attr("stroke","#fff").style("stroke-width","1.5px").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",5).attr("id",function(e){return"submission"+e.id}).style("fill",function(e){groupIds[e.group]=true;return fillNode(e)});if(!graphControls.useFisheye){a.call(b.drag)}a.each(function(e){e.lockedPopover=false;$("#submission"+e.id).popover({delay:graphControls.useFisheye?0:500,animation:!graphControls.useFisheye,placement:function(f){f.id="submissionPopover"+e.id;return"right"},trigger:"manual",title:generateSubmissionPopoverTitle(e),content:generateSubmissionPopoverContent(e)})}).on("mouseover",function(h){overNode=true;if(!h.lockedPopover){var f=$("#submission"+h.id);f.popover("show");var g=parseFloat(f.attr("r"));var e=$("#submissionPopover"+h.id);e.offset({left:mouseX+g,top:mouseY-e.height()/2})}}).on("mouseout",function(e){overNode=false;if(!e.lockedPopover){$("#submission"+e.id).popover("hide")}}).on("click",function(e){e.lockedPopover=!e.lockedPopover}).on("contextmenu",toggleFadeSubmissionNode);return a}function renderGraph(f){$("#submissionList").children().remove();$("#submissionList, #submissionListTitle").hide();hideLegend();$(".popover").hide();var d=$("#page").width()-490;var l=$("#page").height()-10;$("#content").height(l);$("#content").width(d);var m=function(){if(!overNode){$(".popover").hide();b.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}};groupIds={};var b=d3.select("#chart").append("svg").attr("width",d).attr("height",l).attr("pointer-events","all").append("svg:g").call(d3.behavior.zoom().on("zoom",m)).append("svg:g");var g=b.append("svg:rect").attr("width",d*5).attr("height",l*5).attr("x",(-2)*d).attr("y",(-2)*l).attr("fill","white");$("#nodePopup").hover(function(){$("#edgePopup").hide()});$("#edgePopup").hover(function(){$("#nodePopup").hide()});var c=d3.layout.force().charge(-120).linkDistance(60).nodes(f.nodes).links(f.links).size([d,l]).start();var k=b.selectAll("text").data(f.nodes).enter().append("svg:text").attr("class","nodetext").attr("dx",12).attr("dy",3).text(function(i){if(i.type=="solutionsubmission"){return"Solution"}else{if(graphControls.anonymousGraph){return i.id}else{return i.student.netid}}});var j=buildMatchLinks(b,f);var a=buildSubmissionNodes(b,f,c);c.on("tick",function(){j.attr("x1",function(i){return i.source.x}).attr("y1",function(i){return i.source.y}).attr("x2",function(i){return i.target.x}).attr("y2",function(i){return i.target.y});a.attr("cx",function(i){return i.x}).attr("cy",function(i){return i.y});b.selectAll(".nodetext").attr("transform",function(i){return"translate("+i.x+","+i.y+")"})});var h=function(){var i=d3.fisheye().radius(200).power(2);g.on("mousemove",function(){i.center(d3.mouse(this));a.each(function(n){n.display=i(n)}).attr("cx",function(n){return n.display.x}).attr("cy",function(n){return n.display.y}).attr("r",function(n){return n.display.z*4.5});j.attr("x1",function(n){return n.source.display.x}).attr("y1",function(n){return n.source.display.y}).attr("x2",function(n){return n.target.display.x}).attr("y2",function(n){return n.target.display.y});b.selectAll(".nodetext").attr("transform",function(n){return"translate("+n.display.x+","+n.display.y+")"})})};setTimeout(function(){c.stop();if(graphControls.useFisheye){h()}},8000);showLegend();for(var e in submissionIdsOnList){if(submissionIdsOnList.hasOwnProperty(e)){addSubmissionToList(submissionIdsOnList[e])}}}function removeSubmissionFromList(b){$("#submissionEntry"+b).remove();var a=submissionIdsOnList.indexOf(b);submissionIdsOnList.splice(a,1);if(submissionIdsOnList.length===0){$("#submissionList").children().remove();$("#submissionList, #submissionListTitle").hide()}}function addSubmissionToList(e){var g=submissions[e];var d="";d+="<ul class='treeview' id='submissionEntry"+e+"'> Submission "+e+"<div class='closeButton close' onclick='javascript:removeSubmissionFromList("+e+");'>X</div>";d+="<li>Matches<ul>";for(var a in matches){var b=matches[a];var f=(b.score1+b.score2)/2;d+="<li>Match "+b.id+"<ul>";d+="<li>Strength: "+f+"</li>";d+="<li><a href='"+b.link+"'>Analysis</a></li>";d+="</ul></li>"}d+="</ul>";var c=g.student;d+="<li>Student<ul>";if(graphControls.anonymousGraph){d+="<li>Id "+c.id+"</li>";d+="<li><a href='"+c.history_link+"'>Student History</a></li>"}else{d+="<li>"+c.display_name+"</li>";d+="<li>"+c.netid+"</li>";d+="<li>"+c.program_name+"</li>";d+="<li>"+c.level_name+"</li>";d+="<li><a href='"+c.history_link+"'>Student History</a></li>"}d+="</ul></li>";d+="</ul>";$("#submissionListTitle").show();$("#submissionList").append("<li>"+d+"</li>");$("#submissionList").show();$("#submissionEntry"+e).treeview({animated:"fast",collapsed:true,unique:true})};