var courses=null;var currentOfferingId=null;var offerings;var hostname=window.location.hostname;var COURSE_DATA_URL="/viz/getCourseData";var LOAD_ASSIGNMENT_URL="/viz/getMatchesAndSubmissions";if(hostname==="comoto.cs.illinois.edu"){COURSE_DATA_URL="/comoto"+COURSE_DATA_URL;LOAD_ASSIGNMENT_URL="/comoto"+LOAD_ASSIGNMENT_URL}function fetchCourses(a){reportLoadingStatus("Loading course data..");showLoadingPopup();$.ajax({url:COURSE_DATA_URL,data:{},type:"POST",dataType:"json",error:function(b){reportFatalLoadingError(b)},success:function(b){initializeViz(b);hideLoadingPopup();loadSidebar();a()}})}function loadSidebar(){$("#analysisBrowser").treeview({animated:"fast",collapsed:true,unique:true});$("#left-sidebar, #right-sidebar").height($("#wrapper").height()-10);$("#left-sidebar, #right-sidebar").width(0);$("#left-sidebar, #right-sidebar, #content").show();$("#left-sidebar, #right-sidebar").animate({width:200},"slow");initializeControls()}function initializeViz(j){courses=j;offerings={};for(var k in courses){if(courses.hasOwnProperty(k)){var m=courses[k];var l="<li id='courseNode"+m.id+"' class='courseNode'><span class='course'>"+m.name+"</span><ul id='courseOfferingList"+m.id+"' class='offeringList'>";var c=0;for(var h in m.offerings){if(m.offerings[h]["semester"]["type"]==="semester"){var f=m.offerings[h];var n=f.semester["season"]+" "+f.semester["year"];var o="<li id='offeringNode"+f.id+"' class='offeringNode'><span class='offering'>"+n+"</span><ul id='offeringAssignmentList"+f.id+"' class='assignmentList'>";if(!offerings[f.id]){offerings[f.id]=f}var p=f.semester;var d=p.id;var b=m.assignments;var a=0;for(var g in b){var e=b[g];if(e.moss_analysis_pruned_offering.hasOwnProperty("semester")&&e.moss_analysis_pruned_offering["semester"]["id"]===d){var i="<li id='assignmentNode"+e.id+"' class='assignmentNode' onclick=loadAssignment("+e.id+","+f.id+");><span class='assignment'>"+e.name+"</span></li>";o+=i;a+=1}}if(a>0){o+="</ul></li>";l+=o;c+=1}}}if(c>0){l+="</ul></li>";$("#analysisBrowser").append(l)}}}}function loadAssignment(b,a){reportLoadingStatus("Loading data for assignment...");showLoadingPopup();currentOfferingId=a;$(".assignmentNode span").removeClass("selected");$("#assignmentNode"+b+" span").addClass("selected");$.ajax({url:LOAD_ASSIGNMENT_URL,data:{assignmentId:b},type:"POST",dataType:"json",error:reportLoadingError,success:function(c){reportLoadingStatus("Generating analysis graph...");loadGraph(c.matches,c.submissions);hideLoadingPopup();enableControls()}})};